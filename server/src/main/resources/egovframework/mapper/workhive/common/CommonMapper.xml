<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.common.mapper.CommonMapper">
	
	<!-- 공통코드 디테일 전체조회 -->
	<select id="commonSelectAll" parameterType="String" resultType="commonDTO">
		SELECT
		    comm_dtl_nm,
		    comm_dtl_cd
		  FROM
		    common_detail
		    <![CDATA[
		    
		  WHERE
		    UPPER(comm_cd) =  UPPER(#{commCd}) 
		    
		    ]]>
		  ORDER BY
		    comm_dtl_cd
	</select>
	
	<!-- 거래처 전체조회 -->
	<select id="comSelectAll" parameterType="String" resultType="commonDTO">
		SELECT
		    entrprs_mber_id,
		    cmpny_nm,
		    bizrno,
		    cxfc,
		    zip,
		    area_no,
		    entrprs_middle_telno,
		    entrprs_end_telno,
		    fxnum,
		    update_id,
		    update_dt,
		    create_id,
		    create_dt,
		    del_yn
		  FROM 
		  	comtnentrprsmber
		  ORDER BY 
		  	create_dt desc
	</select>
	
	<!-- 홈 대시보드 건수 조회 (진행중인 프로젝트, 금일 예정 일정, 미완료 일지) -->
	<select id="homeInfo" parameterType="String">
	<![CDATA[
	select
	    NVL((select count(*) from project project join project_mem pm on project.pr_cd=pm.pr_cd where project.state='A02' and pm.mem_cd=m.mem_cd),0) as project_cnt,
	    NVL((select count(*) from todo todo where todo.state='A02' and mem_cd=m.mem_cd),0) as todo_cnt,
	    NVL((select count(*) from comtnschdulinfo sch WHERE TRUNC(TO_DATE(SCHDUL_BGNDE, 'YYYYMMDDHH24MI')) <= TRUNC(SYSDATE) and TRUNC(TO_DATE(SCHDUL_ENDDE, 'YYYYMMDDHH24MI')) >= TRUNC(SYSDATE)),0) as sch_cnt
	from member m 
	where mem_cd=#{memCd}
	]]>
	
	</select>
</mapper>