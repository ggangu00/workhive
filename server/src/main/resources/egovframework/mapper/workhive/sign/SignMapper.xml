<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.sign.mapper.SignMapper">
    
    <!-- 부서 전체 사원 목록 조회 -->
    <select id="signerSelectAll" parameterType="signDTO" resultType="signDTO">
        SELECT *
        FROM
        (
            SELECT T0.*, ROWNUM RNUM
            FROM
            (
				
				SELECT mber_id,            -- 회원코드
			       mber_nm,            -- 회원명
			       mbtlnum,            -- 전화번호
			       dept_cd,            -- 부서코드
			       resp_cd,            -- 직책코드
			       grade_cd,           -- 직급코드
			       fn_get_deptnm(mber_id) AS dept_nm,
			       FN_GET_GRADENM(grade_cd) AS gradeNm
				FROM COMTNGNRLMBER
				WHERE dept_cd IN (
				    SELECT dept_cd
				    FROM department
				    START WITH dept_cd = (
		        		<!-- deptCd의 최상위 부서 찾기 (최상위 부서 중 하나만 선택) -->
		        		fn_get_top_dept(#{deptCd})
				    )
				    CONNECT BY PRIOR dept_cd = parent_cd
				)
				order by grade_cd desc
				
            ) T0
        )
        WHERE RNUM BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordCountPerPage}
    </select>

    <!-- 부서 전체 사원 목록 카운트 -->
    <select id="signerSelectCnt" parameterType="signDTO" resultType="Integer">
		SELECT count(mber_id) as cnt
		FROM COMTNGNRLMBER
		WHERE dept_cd IN (
		    SELECT dept_cd
		    FROM department
		    START WITH dept_cd = (
		        <!-- deptCd의 최상위 부서 찾기 (최상위 부서 중 하나만 선택) -->
        		fn_get_top_dept(#{deptCd})
		    )
		    CONNECT BY PRIOR dept_cd = parent_cd
		)
    </select>

</mapper>