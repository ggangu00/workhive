<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:egov-security="http://maven.egovframe.go.kr/schema/egov-security"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd
		http://maven.egovframe.go.kr/schema/egov-security http://maven.egovframe.go.kr/schema/egov-security/egov-security-4.2.0.xsd">

<!--
수정일               수정자			수정내용
==========   ============	=================================================
2011.09.07   서준식                   일반, 업무사용자의 경우 조직아이디가 없어 로그인이 안되던 문제 수정(SQL 수정)
2011.09.25   서준식                   usersByUsernameQuery 쿼리의 조직 아이디 비교 부분  오류 수정 > alias 추가
2014.06.13   Vincent Han    표준프레임워크 3.0 적용 (간소화 설정 사용)
2017.07.10   장동한                   실행행환경 v3.7 적용[보안기능 추가(sniff, xFrameOptions, xssProtection csrf)]
2018.10.26   신용호                   실행행환경 v3.8 적용
2020.08.28   정진오                   표준프레임워크 v3.10 개선
2023.12.20   정진오                   표준프레임워크 v4.2 개선(SpEL(use-expressions) 설정 추가)
-->

	<!-- 특정 경로에 대해 Spring Security 적용 제외 (정적 리소스 허용) -->
	<security:http pattern="/css/**" security="none"/>
	<security:http pattern="/html/**" security="none"/>
    <security:http pattern="/images/**" security="none"/>
 	<security:http pattern="/js/**" security="none"/>
 	<security:http pattern="/resource/**" security="none"/>
 	<security:http pattern="\A/WEB-INF/jsp/.*\Z" request-matcher="regex" security="none"/>
  	
  	<!-- eGovFrame 보안 설정 -->
  	<!-- 
  		loginUrl : 로그인 URL
  		logoutSuccessUr : 로그아웃 후 이동할 페이지
  		loginFailureUrl : 로그인 실패 시 이동할 페이지
  		accessDeniedUrl : 접근 거부 시 이동할 페이지
  		dataSource : 데이터베이스 연결 설정
  		jdbcUsersByUsernameQuery : 사용자 인증을 위한 SQL 쿼리
  		requestMatcherType : 요청 매칭 방식 (정규식 사용)
  		hash : 비밀번호 암호화 방식 (현재는 평문 저장) 
  		concurrentMaxSessons : 동시 로그인 가능 개수 제한
  		concurrentExpiredUrl : 동시 로그인 초과 시 이동할 페이지
  		defaultTargetUrl : 로그인 성공 후 이동할 기본 URL
  		sniff : X-Content-Type-Options 설정 (MIME 스니핑 방지)
  		xframeOptions : X-Frame-Options 설정 (클릭재킹 방지)
  		xssProtection : XSS 보호 활성화
  		csrf : CSRF 보호 비활성화
  		csrfAccessDeniedUrl : CSRF 차단 시 이동할 페이지
  	 -->
    <egov-security:config id="securityConfig"
		loginUrl="/uat/uia/egovLoginUsr.do" 
		logoutSuccessUrl="/EgovContent.do"
		loginFailureUrl="/uat/uia/egovLoginUsr.do?login_error=1"
		accessDeniedUrl="/sec/ram/accessDenied.do"

		dataSource="egov.dataSource"
		jdbcUsersByUsernameQuery="SELECT USER_ID, ESNTL_ID AS PASSWORD, 1 ENABLED, USER_NM, USER_ZIP,
                                                              USER_ADRES, USER_EMAIL, ORGNZT_ID, ESNTL_ID,
                                                              (select a.ORGNZT_NM from COMTNORGNZTINFO a where a.ORGNZT_ID = m.ORGNZT_ID) ORGNZT_NM
                                                       FROM COMVNUSERMASTER m WHERE USER_ID =?"
		jdbcMapClass="egovframework.com.sec.security.common.EgovSessionMapping"

		requestMatcherType="regex"
		hash="plaintext"
		hashBase64="false"

		concurrentMaxSessons="1"
		concurrentExpiredUrl="/EgovContent.do"
		errorIfMaximumExceeded="false"

		defaultTargetUrl="/EgovContent.do"
		alwaysUseDefaultTargetUrl="true"

		sniff="true"
		xframeOptions="SAMEORIGIN" 
		xssProtection="true" 
		cacheControl="false"
		csrf="false"
		csrfAccessDeniedUrl="/egovCSRFAccessDenied.do"
	/>

	<!-- 보안 객체 설정 (역할 기반 접근 제어) -->
	<egov-security:secured-object-config id="securedObjectConfig"
		sqlHierarchicalRoles="
			SELECT a.CHLDRN_ROLE as child, a.PARNTS_ROLE parent
			FROM COMTNROLES_HIERARCHY a LEFT JOIN COMTNROLES_HIERARCHY b on (a.CHLDRN_ROLE = b.PARNTS_ROLE)"
		sqlRolesAndUrl="
			SELECT a.ROLE_PTTRN url, b.AUTHOR_CODE authority
			FROM COMTNROLEINFO a, COMTNAUTHORROLERELATE b
			WHERE a.ROLE_CODE = b.ROLE_CODE
				AND a.ROLE_TY = 'url'  ORDER BY a.ROLE_SORT"
		sqlRolesAndMethod="
			SELECT a.ROLE_PTTRN as 	&quot;method&quot;, b.AUTHOR_CODE authority
			FROM COMTNROLEINFO a, COMTNAUTHORROLERELATE b
			WHERE a.ROLE_CODE = b.ROLE_CODE
			AND a.ROLE_TY = 'method'  ORDER BY a.ROLE_SORT"
		sqlRolesAndPointcut="
			SELECT a.ROLE_PTTRN pointcut, b.AUTHOR_CODE authority
			FROM COMTNROLEINFO a, COMTNAUTHORROLERELATE b
			WHERE a.ROLE_CODE = b.ROLE_CODE
			AND a.ROLE_TY = 'pointcut'  ORDER BY a.ROLE_SORT"
		sqlRegexMatchedRequestMapping="
			SELECT a.ROLE_PTTRN uri, b.AUTHOR_CODE authority
			FROM COMTNROLEINFO a, COMTNAUTHORROLERELATE b
			WHERE a.ROLE_CODE = b.ROLE_CODE
			AND a.ROLE_TY = 'regex'  
			ORDER BY a.ROLE_SORT"
	/>
	<!-- 보안 초기화 설정 (Method 보안 활성화) -->
	<egov-security:initializer id="initializer" supportMethod="true" supportPointcut="false" />

    <!-- URL에 세미콜론(semicolon)허용 여부(기본값/false) -->
	<!-- 
	<bean id="egovStrictHttpFirewall" class="org.springframework.security.web.firewall.StrictHttpFirewall">
		<property name="allowSemicolon" value="true"/>
	</bean>
	<security:http-firewall ref="egovStrictHttpFirewall"/>
	-->

</beans>
